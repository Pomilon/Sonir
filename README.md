# Sonir

Sonir is a modular, physics-based audio visualizer engine written in Python. It turns audio tracks into dynamic 2D geometric worlds where a projectile travels at constant speed, bouncing off walls generated by musical onsets.

## Features

- **Physics-Based Visualization**: A deterministic engine that maps musical timing (onsets) to a 2D flight path.
- **Multiple Modes**:
  - **Stem Mode**: Visualizes 4 separated stems (Drums, Bass, Other, Vocals) in a quad-view.
  - **Piano Mode**: Optimized for sharp transient detection (400Hz-4500Hz) for piano performances.
  - **Multi-Band Mode**: Splits a single track into 4 frequency bands (Bass, Low-Mid, High-Mid, Treble).
  - **Two-Band Mode**: Splits audio into Low (Bass) and High (Treble) frequencies.
- **High-Quality Rendering**:
  - **Real-time Preview**: Uses Pygame for instant feedback.
  - **Headless Export**: Renders frame-by-frame to PNGs and stitches them into a high-bitrate 60FPS MP4 using FFmpeg (prevents audio drift).

## Gallery

<div align="center">
  <h3>Piano Sample (Piano Mode)</h3>
  <video src="https://raw.githubusercontent.com/Pomilon/Sonir/refs/heads/main/examples/Videos/piano_sample.mp4" width="100%" controls preload="metadata"></video>

  <h3>Crystal Caverns (Multi-Band Mode)</h3>
  <video src="https://raw.githubusercontent.com/Pomilon/Sonir/refs/heads/main/examples/Videos/crystal_caverns.mp4" width="100%" controls preload="metadata"></video>
  
  <h3>Cyber Chase (Multi-Band Mode)</h3>
  <video src="https://raw.githubusercontent.com/Pomilon/Sonir/refs/heads/main/examples/Videos/cyber_chase.mp4" width="100%" controls preload="metadata"></video>
</div>

## Installation

1. **Clone the repository:**
   ```bash
   git clone https://github.com/Pomilon/Sonir.git
   cd Sonir
   ```

2. **Install Python dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

3. **System Dependencies:**
   - **FFmpeg**: Required for the `--export` video generation feature.
     - Linux: `sudo apt install ffmpeg`
     - macOS: `brew install ffmpeg`
     - Windows: Download from [ffmpeg.org](https://ffmpeg.org/download.html) and add to PATH.
   - **Demucs** (Optional): If you want to use `Stem Mode`, you need pre-separated tracks.
     ```bash
     pip install demucs
     ```

## Usage

The unified entry point is `main.py`.

### 1. Real-time Preview

**Piano Mode (Single View)**
```bash
python main.py --audio "piano.mp3" --mode piano
```

**Multi-Band Mode (4-Quadrant Frequency Split)**
```bash
python main.py --audio "song.mp3" --mode multiband
```

**Two-Band Mode (Left/Right Frequency Split)**
```bash
python main.py --audio "song.mp3" --mode twoband
```

**Stem Mode**
*Note: This mode requires a `separated/htdemucs/[song_name]/` folder structure generated by Demucs.*
```bash
# First, separate the tracks
demucs -n htdemucs "song.mp3"

# Then run Sonir
python main.py --audio "song.mp3" --mode stem
```

### 2. Export to Video

Add `--export` to any command to render a high-quality MP4.

```bash
python main.py --audio "song.mp3" --mode multiband --export --output "visualizer.mp4"
```

## Project Structure

- `sonir/core.py`: Deterministic physics engine.
- `sonir/analyzer.py`: Audio analysis (STFT, Onset Detection).
- `sonir/renderer.py`: Pygame rendering engine (Real-time & Headless).
- `sonir/config.py`: Centralized configuration (Colors, Speed, Resolution).
