# Sonir

Sonir is a modular, physics-based audio visualizer engine written in Python. It turns audio tracks into dynamic 2D geometric worlds where a projectile travels at constant speed, bouncing off walls generated by musical onsets.

## Disclaimer

**Sonir is experimental.** While it has been tuned to handle a wide variety of musical genres, please keep the following in mind:

*   **Not Universal:** It may not perfectly sync with every single track. Songs with extremely complex polyrhythms, low dynamic range, or muddy mixes may result in less accurate wall generation.
*   **Physics Constraints:** The "flight path" is deterministic. In rare edge cases with extremely rapid onsets, the projectile physics might behave unexpectedly.
*   **Intended Use:** This is a creative coding project designed for visual art, not a precision-grade rhythm game engine.


## Features

- **Physics-Based Visualization**: A deterministic engine that maps musical timing (onsets) to a 2D flight path.
- **Multiple Modes**:
  - **Stem Mode**: Automatic separation of Drums, Bass, Other, Vocals (using Demucs).
  - **Piano Mode**: Optimized for sharp transient detection (400Hz-4500Hz).
  - **Multi-Band & Spectrum**: Frequency-based splitting (Bass, Mids, Highs).
  - **Genre Specific**: Dedicated modes for `Drums`, `Violin`, and `KickBass` (Electronic).
  - **FiveBand**: A cinematic center-focus layout.
- **High-Quality Visuals**:
  - **"Juice" Effects**: Screen Shake, Impact Particles, Motion Trails, and Neon Glow.
  - **Dynamic Backgrounds**: Pulsing starfields and reactive environments.
  - **Cinema Camera**: Dynamic camera movement that leads the action.
  - **Theming**: 5 built-in color themes (`neon`, `cyberpunk`, `noir`, `sunset`, `matrix`).
- **Flexible Output**:
  - **Real-time Preview**: Resizeable window using Pygame.
  - **Video Export**: Drift-free 60FPS MP4 export (H.265/HEVC by default) with customizable Aspect Ratios (`16:9`, `9:16`, `1:1`, etc).

## Gallery

<div align="center">
  <h3>Piano Sample (Piano Mode)</h3>
  <video src="https://github.com/user-attachments/assets/96d18fc1-8b7b-410f-9b51-fad4c8d5ce9f" width="100%" controls preload="metadata"></video>

  <h3>Crystal Caverns (Stem Mode)</h3>
  <video src="examples/Videos/crystal_caverns.mp4" width="100%" controls preload="metadata"></video>
  
  <h3>Cyber Chase (Stem Mode)</h3>
  <video src="examples/Videos/cyber_chase.mp4" width="100%" controls preload="metadata"></video>
</div>

## Installation

1. **Clone the repository:**

```bash
git clone https://github.com/Pomilon/Sonir.git
cd Sonir
```

2. **Install Python dependencies:**

```bash
pip install -r requirements.txt
```

3. **System Dependencies:**
   - **FFmpeg**: Required for the `--export` video generation feature.
     - Linux: `sudo apt install ffmpeg`
     - macOS: `brew install ffmpeg`
     - Windows: Download from [ffmpeg.org](https://ffmpeg.org/download.html) and add to PATH.
   - **Demucs** (Optional): If you want to use `Stem Mode`, you need pre-separated tracks.

     ```bash
     pip install demucs
     ```

## Usage

The unified entry point is `main.py`.

### 1. Basic Modes

**Piano Mode (Single View)**
```bash
python main.py --audio "piano.mp3" --mode piano
```

**Stem Mode (Source Separation)**
*Automatically runs Demucs to split the track into 4 stems.*
```bash
python main.py --audio "song.mp3" --mode stem
```

**Genre-Specific**
```bash
# For Electronic/Dance
python main.py --audio "edm.mp3" --mode kickbass

# For Drum Covers
python main.py --audio "drums.mp3" --mode drums

# For Classical/Solo
python main.py --audio "concerto.mp3" --mode violin
```

### 2. Customization (Themes & Layouts)

**Vertical Video (TikTok/Shorts) with Cyberpunk Theme**
```bash
python main.py --audio "song.mp3" --mode fiveband --aspect 9:16 --theme cyberpunk
```

**Square Video (Instagram) with Noir Theme**
```bash
python main.py --audio "jazz.mp3" --mode spectrum --aspect 1:1 --theme noir
```

### 3. Export to Video

Add `--export` to render a high-quality MP4. You can customize the encoder (`--encoder`) and quality (`--crf`).

```bash
# Default H.265 Export
python main.py --audio "song.mp3" --mode stem --export --output "visualizer.mp4"

# Customize Encoding
python main.py --audio "song.mp3" --mode stem --export --encoder libx264 --crf 18
```

### 4. Advanced Flags

- `--no-shake`: Disable screen shake.
- `--no-particles`: Disable impact particles.
- `--no-trails`: Disable motion trails.
- `--no-glow`: Disable neon glow.
- `--no-bg`: Disable dynamic background.
- `--no-cam`: Disable cinema camera movement.
- `--no-ui`: Hide the progress bar overlay.

## Project Structure

- `sonir/core.py`: Deterministic physics engine.
- `sonir/analyzer.py`: Audio analysis (STFT, Onset Detection).
- `sonir/renderer.py`: Pygame rendering engine (Real-time & Headless).
- `sonir/config.py`: Centralized configuration (Colors, Speed, Resolution).
